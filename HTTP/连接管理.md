# 连接管理

与建立 TCP 连接，传输请求和响应报文的时间相比，事务处理的事件可能是很短的。

HTTP 时延有以下主要原因

1. 解析服务器的 IP 地址和端口号，如果 DNS 未缓存，需要通过 DNS 解析。

2. 发送 TCP 连接的时延

3. 一旦连接建立，发送请求，服务器处理请求都需要时间

4. 服务器返回响应花费一段时间

## TCP 慢启动

TCP 连接起初会限制连接的最大速度，如果数据传输成功，会随着时间的推移提高传输速度。这种“协调”称为 **TCP 慢启动**，用于防止因特网的突然过载和拥塞。

因为 TCP 慢启动，所以新连接比已经建立连接并传输成功数据的连接要慢一点，因此 HTTP 中有一些可以重用现有连接的工具。

## Nagle 算法

TCP 中的数据可以是任意大小，每次传输 1 个字节的数据也可以，但是 TCP 段自身至少包含 40 个字节的标记和首部，因此每次传输多个但是数据量少的分组，就会降低网络的性能。

Nagle 算法试图在发送分组之前，将数据塞满整个分组，减少需要发送分组的个数，提高网络的效率，Nagle 算法鼓励发送全尺寸的分组，只有当其他分组都被确认后，才允许发送非全尺寸的分组。

Nagle 算法会引发几种 HTTP 性能问题，首先，小的 HTTP 分组无法填满一个报文，可能需要等待其他数据填满分组。其次，Nagle 算法与延迟确认存在问题，算法会阻止数据的发送，直到有确认分组到达为止，因此反而增加了数据传输的延时。
