# 其他跨域技术

在 CORS 出现之前，要实现跨域 Ajax 通信颇费一些周折。开发人员想出了一些办法，利用 DOM 中能够执行跨域的功能，在不依赖 XHR 对象的情况下也能发送某种请求。

**虽然 CORS 技术已经无处不在，但开发人员自己发明的这些技术仍然被广泛使用，毕竟这样不需要发送修改服务器代码。**

## 图像 Ping

## JSONP

JSONP 是 JSON with padding（填充式 JSON 或参数式 JSON）的简写，是应用 JSON 的一种新方法，在后来的 Web 服务中非常流行。

> callback({"name": "septwood"});

**JSONP 由两部分组成：回调函数和数据。**回调函数是当响应到来时应该在页面中调用的函数。回调函数的名字一般是在请求中指定的。而数据就是传入回调函数中的 JSON 数据。

一个典型的 JSONP 请求：

> <http://freegeoip.net/json/?callback=handleResponse>

通过查询字符串来指定 JSONP 服务的回调参数是很常见的，就像上面的 URL 所示，这里制定的回调函数的名字叫 handleResponse()。

**JSONP 是通过动态 script 元素来使用的，使用时可以为 src 属性指定一个跨域 URL。这里的 script 元素与 img 元素类似，都有能力不受限制地从其他域加载资源。**

JSONP 之所以在开发人员中极为流行，主要原因是它非常简单易用，优点在于能够直接访问响应文本，支持在浏览器与服务器之间双向通信。不过，JSONP 有两点不足。

一是安全问题，由于会加载其他域的代码，如果其他域不安全，可能会在响应中夹带一些恶意代码。因此在使用不是自己运维的 Web 服务时，一定得保证它安全可靠。

其次，要确定 JSONP 请求是否失败并不容易。虽然 HTML5 给 script 元素新增了一个 onerror event handler，但目前还没有得到任何浏览器的支持。为此，开发人员不得不使用计时器检测指定时间内是否接收到了响应。但就算这样也不能尽如人意。

## Comet

Ajax 时一种从页面向服务器请求数据的技术，而 Comet 则是一种服务器向页面推送数据的技术。Comet 能够让信息近乎实时地被推送到页面上，非常适合处理体育比赛的分数和股票报价。

有两种实现 Comet 的方式：长轮询和流。长轮询是短轮询的一个翻版。

短轮询：浏览器定时向服务器发送数据，看看有没有更新的数据。

长轮询：页面发起一个到服务器的请求，然后服务器一直保持连接打开，直到有数据可发送。服务器发送完数据之后，浏览器关闭连接，随即又发起一个到服务器的新请求。这一过程在页面打开期间一直连续不断。

不论是短轮询还是长轮询，浏览器都要在接受数据之前，先发起对服务器的连接。

轮询的优势是所有浏览器都支持，因为使用 XHR 对象和 setTimeout() 就能实现。

第二种实现 Comet 的方式是 HTTP 流。流不同于上述两种轮询，因为它在页面的整个生命周期内只使用一个 HTTP 连接。具体来说就是浏览器向服务器发送一个请求，而服务器保持连接打开，然后周期性的向浏览器发送数据。

## 服务器发送事件

Server-Sent Events，SSE，服务器发送事件是围绕只读 Comet 交互推出地 API 或者模式。

## Web Sockets

Web Sockets 的目标是在一个单独的持久连接上提供全双工、双向通信。

## SSE 与 Web Socket
